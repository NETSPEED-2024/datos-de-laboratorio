<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Generador de Datos â€” Creado por William Campal</title>
<style>
:root{--primary:#2c3e50;--secondary:#3498db;--danger:#e74c3c}
body{font-family:Inter,"Segoe UI",Tahoma,sans-serif;background:#f4f6f8;margin:0;color:#222}
header{background:var(--primary);color:#fff;padding:14px;text-align:center}
header h1{margin:0;font-size:18px}
.container{max-width:1100px;margin:12px auto;padding:0 12px}
.card{background:#fff;border-radius:10px;padding:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
label{display:block;font-weight:600;margin-top:10px}
textarea,input,select{width:100%;padding:10px;border:1px solid #dcdfe6;border-radius:6px;font-size:14px;box-sizing:border-box}
.btn{background:var(--secondary);color:#fff;border:0;padding:10px 12px;border-radius:6px;margin:6px 6px 6px 0;cursor:pointer}
.btn-danger{background:var(--danger)}
.out{background:#fbfdff;border:1px solid #e6eef9;padding:10px;border-radius:6px;min-height:160px;white-space:pre-wrap;font-family:monospace}
.small{font-size:13px;color:#555;margin-top:6px}
footer{padding:12px;text-align:center;font-size:13px;color:#666}
fieldset{border:1px solid #e3e6ea;border-radius:8px;padding:8px;margin-top:10px}
legend{font-weight:700}
</style>
</head>
<body>
<header><h1>Generador de Datos â€” Creado por William Campal</h1></header>

<div class="container">

<div class="card">
  <h3>ğŸ“‹ Procesar desde Excel</h3>

  <label>Seleccionar plantilla</label>
  <select id="sheetType">
    <option value="203">203</option>
    <option value="302">302</option>
    <option value="402-403">402-403</option>
    <option value="brine">BRINE</option>
    <option value="li2co3">Liâ‚‚COâ‚ƒ</option>
    <option value="reporte_id">Reporte I+D</option>
  </select>

  <label>Pegar filas copiadas desde Excel</label>
  <textarea id="excelData" placeholder="Pega aquÃ­ las filas copiadas desde Excel..."></textarea>

  <div>
    <button class="btn" onclick="pegarDesdePortapapeles()">ğŸ“‹ Pegar</button>
    <button class="btn" onclick="procesarExcel()">âš™ï¸ Procesar</button>
    <button class="btn btn-danger" onclick="limpiar()">ğŸ§¹ Limpiar</button>
  </div>

  <label>Salida generada</label>
  <div id="salida" class="out"></div>

  <div>
    <button class="btn" onclick="copiarSalida()">ğŸ“„ Copiar</button>
    <button class="btn" onclick="abrirWhatsappPrimerRegistro()">ğŸ’¬ WhatsApp</button>
  </div>
</div>

<script>
/* =================== PLANTILLAS =================== */
const plantillas={

"203":[
  { nombre:"IdentificaciÃ³n", i:0 },
  { nombre:"CÃ³digo", i:1 },

  { nombre:"B", i:2, u:"mg/L" },
  { nombre:"Ca", i:3, u:"mg/L" },
  { nombre:"K", i:4, u:"mg/L" },
  { nombre:"Mg", i:5, u:"mg/L" },
  { nombre:"Na", i:6, u:"mg/L" },

  { nombre:"Humedad", i:7, u:"%" },
  { nombre:"Fe", i:8, u:"mg/L" },
  { nombre:"SO4", i:9, u:"mg/L" },
  { nombre:"CO3", i:10, u:"mg/L" },
  { nombre:"HCO3", i:11, u:"mg/L" },
  { nombre:"OH", i:12, u:"mg/L" },

  { nombre:"pH", i:13 },
  { nombre:"densidad", i:14, u:"g/ml" },
  { nombre:"Conductividad", i:15, u:"ÂµS/cm" },
  { nombre:"Dureza Total", i:16, u:"mg/L" },
  { nombre:"Turbidez", i:17, u:"NTU" },
  { nombre:"Si/ICP", i:18, u:"mg/L" },
  { nombre:"OD", i:19, u:"%" },
  { nombre:"Pureza", i:20, u:"%" }
],

"302":[
  { nombre:"IdentificaciÃ³n", i:0 },
  { nombre:"CÃ³digo", i:1 },
  { nombre:"B", i:2, u:"ppm" },
  { nombre:"Ca", i:3, u:"ppm" },
  { nombre:"K", i:4, u:"ppm" },
  { nombre:"Li", i:5, u:"ppm" },
  { nombre:"Mg", i:6, u:"ppm" },
  { nombre:"Na", i:7, u:"ppm" },
  { nombre:"densidad", i:8, u:"g/ml" },
  { nombre:"pH", i:9 },
  { nombre:"Na2CO3", i:10, u:"%" },
  { nombre:"temperatura", i:11, u:"Â°C" },
  { nombre:"CO3", i:12, u:"ppm" },
  { nombre:"HCO3", i:13, u:"ppm" },
  { nombre:"NaOH", i:14, u:"ppm" },
  { nombre:"OH", i:15, u:"ppm" },
  { nombre:"Fe", i:16, u:"ppm" },
  { nombre:"% SÃ³lidos", i:17, u:"%" },
  { nombre:"Conductividad", i:18, u:"ÂµS/cm" },
  { nombre:"TDS", i:19, u:"ppm" },
  { nombre:"Cloruros", i:20, u:"%" },
  { nombre:"Salinidad", i:21, u:"%" },
  { nombre:"Turbidez", i:22, u:"NTU" },
  { nombre:"Cloro Libre", i:23, u:"mg/L" },
  { nombre:"OD", i:24, u:"%" }
],

"402-403":[
 {nombre:"IdentificaciÃ³n",i:0},
 {nombre:"CÃ³digo",i:1},
 {nombre:"B",i:2,u:"mg/L"},
 {nombre:"Ca",i:3,u:"mg/L"},
 {nombre:"K",i:4,u:"mg/L"},
 {nombre:"Li",i:5,u:"mg/L"},
 {nombre:"Mg",i:6,u:"mg/L"},
 {nombre:"Na",i:7,u:"mg/L"},
 {nombre:"Fe",i:8,u:"mg/L"},
 {nombre:"SO4",i:9,u:"mg/L"},
 {nombre:"CO3",i:10,u:"mg/L"},
 {nombre:"HCO3",i:11,u:"mg/L"},
 {nombre:"pH",i:12},
 {nombre:"Densidad",i:13,u:"g/ml"},
 {nombre:"Conductividad",i:14,u:"ÂµS/cm"}
],

"brine":[
 {nombre:"IdentificaciÃ³n",i:0},
 {nombre:"CÃ³digo",i:1},
 {nombre:"Ca",i:2,u:"mg/L"},
 {nombre:"K",i:3,u:"mg/L"},
 {nombre:"Li",i:4,u:"mg/L"},
 {nombre:"Mg",i:5,u:"mg/L"},
 {nombre:"Na",i:6,u:"mg/L"},
 {nombre:"SO4",i:7,u:"mg/L"},
 {nombre:"CO3",i:8,u:"mg/L"},
 {nombre:"HCO3",i:9,u:"mg/L"},
 {nombre:"Cl",i:10,u:"mg/L"},
 {nombre:"pH",i:11},
 {nombre:"Densidad",i:12,u:"g/ml"}
],

"li2co3":[
 {nombre:"IdentificaciÃ³n",i:0},
 {nombre:"CÃ³digo",i:1},
 {nombre:"Li2CO3 %",i:2,u:"%"},
 {nombre:"Na",i:3,u:"mg/kg"},
 {nombre:"K",i:4,u:"mg/kg"},
 {nombre:"Ca",i:5,u:"mg/kg"},
 {nombre:"Mg",i:6,u:"mg/kg"},
 {nombre:"Fe",i:7,u:"mg/kg"},
 {nombre:"Ni",i:8,u:"mg/kg"},
 {nombre:"Mn",i:9,u:"mg/kg"},
 {nombre:"Cu",i:10,u:"mg/kg"},
 {nombre:"Zn",i:11,u:"mg/kg"},
 {nombre:"pH",i:12}
],

"reporte_id":[
 {nombre:"IdentificaciÃ³n",i:0},
 {nombre:"CÃ³digo",i:1},
 {nombre:"Ensayo",i:2},
 {nombre:"Resultado",i:3},
 {nombre:"Unidad",i:4},
 {nombre:"Observaciones",i:5}
]
};

/* ==== ConversiÃ³n correcta punto decimal ==== */
function normalize(value){
 if(!value)return"";
 return value.replace(",",".");
}

/* =================== PROCESAR PEGADO =================== */
function procesarExcel(){
 const raw=document.getElementById("excelData").value.trim();
 if(!raw){alert("PegÃ¡ filas desde Excel");return;}

 const rows=raw.split(/\n/);
 const tipo=document.getElementById("sheetType").value;
 const plantilla=plantillas[tipo];
 let salida="";

 rows.forEach(line=>{
   let cols=line.split(/\t|;/);
   if(cols.length<2)return;

   let mapa={};
   plantilla.forEach(obj=>{
     mapa[obj.nombre]= normalize(cols[obj.i]||"");
   });

   /* âœ… CorrecciÃ³n automÃ¡tica del error pH â†” densidad en hoja 203 */
   if(tipo==="203"){
     let pH = parseFloat(mapa["pH"]);
     let dens = parseFloat(mapa["densidad"]);

     if((isNaN(pH) || mapa["pH"]==="") && !isNaN(dens) && dens>=0 && dens<=14){
       mapa["pH"] = mapa["densidad"];
       mapa["densidad"] = "";
     }
   }

   salida+=`ğŸ”¹ IdentificaciÃ³n: ${mapa["IdentificaciÃ³n"]||"N/D"}\nğŸ”¹ CÃ³digo: ${mapa["CÃ³digo"]||"N/D"}\n`;

   plantilla.forEach((obj,j)=>{
     if(j<2)return;
     let v = mapa[obj.nombre];
     if(!v)return;
     salida+=`â€¢ ${obj.nombre}: ${v}${obj.u?(" "+obj.u):""}\n`;
   });

   salida+="-------------------------\n";
 });

 document.getElementById("salida").textContent=salida;
}

/* UTILIDADES */
async function pegarDesdePortapapeles(){document.getElementById("excelData").value=await navigator.clipboard.readText();}
function copiarSalida(){navigator.clipboard.writeText(document.getElementById("salida").textContent);}
function abrirWhatsappPrimerRegistro(){
 const t=document.getElementById("salida").textContent.split("-------------------------")[0];
 window.open("https://web.whatsapp.com/send?text="+encodeURIComponent(t),"_blank");
}
function limpiar(){document.getElementById("excelData").value="";document.getElementById("salida").textContent="";}
</script>

</div>
<footer>Generador de Datos â€” Creado por William Campal 09/11/2025 Â© 2025</footer>
</body>
</html>
